# [기획서 초안] Goal-Based Investing (목표 기반 투자) 타당성 검증기

## 1. 개요

* **프로젝트명:** Noah's GBI (Goal-Based Investing) Feasibility Engine

* **선택 주제:** 5. 저축 목표 & 자금 계획 


* **개발 목표:** 개인의 재무 목표 달성 가능성을 수학적으로 검증하고, 목표와 현재 상태의 괴리(Gap)를 줄이는 정량적 솔루션을 제공하는 웹 애플리케이션 프로토타입

* **설계 원칙:** 본 엔진은 Deterministic 계산 기반으로 설계되었으며, 투자 수익률 역산이나 기간 최적화와 같은 비선형 최적화 문제는 과제 범위를 넘어서는 영역으로 판단하여 제외하였음


* GitHub: https://github.com/KO-JUNSUNG/GBI.git
* 배포 URL: 


## 2. 문제 정의

### 2.1 배경 및 문제 인식

* **현상:** 많은 개인 투자자들이 "3년 뒤 1억 모으기"와 같은 재무 목표를 세우지만, 현재의 저축액과 투자 수익률로 이 목표가 실현 가능한지(Feasibility)를 판단하지 못함
* **문제점:** 기존의 금융 계산기는 단순히 미래 가치(FV)만 보여줄 뿐, 목표 달성 실패 시 "무엇을(기간, 금액, 수익률) 얼마나 조정해야 하는지"에 대한 구체적인 대안을 제시하지 못함
* **해결책:** 사용자의 목표와 제약 조건(월 저축 가능액)을 입력받아 달성 가능성(Feasibility)을 시뮬레이션하고, 목표 달성을 위한 최소 필요 적립액(Required PMT)과 최적의 조정안을 역산하여 제안하는 엔진을 개발

### 2.2 선정 근거

* **금융 공학적 접근:** 자산운용사의 핵심 역량인 **ALM(자산부채종합관리)** 프로세스를 개인 금융 레벨로 축소하여 적용. 미래의 목표 지출(Liability)을 맞추기 위해 현재의 자산(Asset)을 어떻게 운용해야 하는지 최적화 문제를 풀고자 함
* **측정 가능한 목표:** "막연한 부자 되기"가 아니라, "Gap = 0"을 만드는 수학적 모델링에 집중하여 개발자의 논리적 사고력을 보여주기에 적합하다고 판단함

## 3. 기능 범위 및 명세 (Scope) 

시간 제약(48시간) 내에 금융 로직의 정합성을 완벽히 구현하기 위해 핵심 기능에 집중하고, 불필요한 기능은 과감히 배제하고자 함

| 구분 | 기능명 | 상세 내용 | 비고 |
| --- | --- | --- | --- |
| **핵심 (Primary)** | **TVM 계산 엔진** | 세후 수익률, 물가상승률 기반의 복리 및 실질 가치 산출 로직 |  |
| **핵심 (Primary)** | **Solution 역산** | 목표 달성 실패 시, 부족한 금액(Gap)을 계산하고 이를 메우기 위한 **'필요 월 저축액'** 자동 산출 | 최적화 로직 |
| **부가 (Secondary)** | **시계열 데이터 생성**  | 월별 자산 성장 추이(명목/실질) 데이터를 생성하여 차트 정합성 확보 | 신규 추가 |
| **부가 (Secondary)** | **동적 시뮬레이션** | 슬라이더 조정을 통해 기간 연장, 금액 증액 시나리오를 실시간 차트로 시각화 | Streamlit 활용 |
| **제외 (Out)** | 회원가입/로그인 | 사용자 식별이 불필요한 단일 세션 프로토타입으로 개발 (로컬 스토리지 활용) | **개발 효율성** |
| **제외 (Out)** | LLM 챗봇 기능 | 금융 계산의 정확성(Deterministic) 보장을 위해 비결정론적 AI 모델 배제 | **리스크 관리** |

## 4. 사용자 시나리오 (User Scenario) 

**Persona:** 결혼 자금 마련이 시급한 30대 직장인 '노아'

1. **Input:** "3년(36개월) 뒤 결혼 자금 5,000만 원 필요. 현재 월 100만 원 저축 가능(예금 금리 3.5%)."
2. **Process:** 시스템이 TVM 엔진을 구동하여 36개월 후 예상 금액(약 3,780만 원)을 산출하고, 목표액 5,000만 원과의 Gap(-1,220만 원)을 진단.
3. **Output (Fail):** "현재 플랜으로는 목표 달성이 불가능합니다. (달성률 75%)"
4. **Solution:** 시스템이 대안 제시.
* A안 (금액 조정): 현재 구현, e.g. "월 34만 원을 더 저축하세요."
* B안 (기간 조정): 향후 확장 기능, e.g. "목표 시기를 11개월 늦추세요."
* C안 (수익률 조정): 향후 고도화 과제, "투자 수익률 9.2% 상품으로 변경하세요."

5. **Action:** 사용자가 슬라이더를 움직여 현실적인 타협안을 도출하고 최종 플랜 확정.

## 5. 엣지 케이스 및 방어 로직 

* **Case 1: 비현실적 목표 (Over-Goal)**
* 상황: 월 10만 원으로 1년 뒤 10억 모으기 입력.
* 처리: 비현실적 입력에 대해 Validation Layer에서 차단


* **Case 2: 이자율 0% 또는 음수**
* 상황: 금리가 0%일 때 복리 공식의 분모가 0이 되는 오류(`ZeroDivisionError`).
* 처리: 이자율이 0일 경우 별도의 '단리 합산 로직'으로 분기 처리하여 에러 방지.



## 6. AI 활용 및 협업 기록 

### 6.1 주제 탐색 및 의사결정

* 활용: AI를 브레인스토밍 파트너로 활용하여 과제 주제별 가능한 문제 정의 방향과 구현 리스크를 정리하였음
    * 1. 저축 목표 & 자금 계획: 목적 기반 투자(Goal-Based Investing) 시뮬레이터
        * 다중 목표(Multi-objective) 달성을 위한 최적 월 적립액 산출
        * 사용자의 추상적인 목표를 LLM을 사용하여 구체적인 금액과 시기로 변환하고, 투자 성향에 따른 상품 추천 로직 생성
    * 2. 대출 & 빚 관리: 이자 비용 최소화를 위한 부채 상환 최적화
        * 현금 흐름 제약 조건 하에서의 이자 비용 최소화 문제
        * 복잡한 대출 약관 텍스트를 입력하면 핵심 변수(금리, 중도상환수수료)를 추출하여 시뮬레이터에 입력
    * 3. 생애주기비용 기반의 자산 매입 의사결정 도구
    * ...
* 검증: AI는 다양한 아이디어를 제시했으나, 본 프로젝트의 핵심 제약 사항(48시간 마감, 금융 로직의 정합성)을 기준으로 직접 최종 주제를 선정하였음
    * 노아에이티에스의 업무(Asset Management)와 가장 맞닿아 있고, 본인의 최적화 연구 경험을 반영하기 좋은 주제라 생각하여 **저축 목표 & 자금 계획: 목적 기반 투자(Goal-Based Investing) 시뮬레이터**를 선택
    * 시간 비용을 고려하여 먼저 단일 재무 목표에 대하여 구현하고, 시간적 여유가 있다면 다중 재무 목표에 대하여 확장 예정
    * LLM을 사용하는 것은 개발 비용이 과하게 투자되고, 서버의 리소스를 다량 소모하기 때문에 해당 기능 대신 Form으로 "목표 금액, 기간, 현재 월 저축액, 예상 수익률"을 입력받고자 함

### 6.2 범위 재설정 및 AI 통제

* 문제 발견: AI의 초기 제안 중 과제 의도와 어긋나는 부분(서비스 내 AI 기능 구현 위주 접근: LLM 챗봇 기능 도입)을 발견하였음. 해당 제안은 사전과제의 설명 중 AI 활용 능력이라고 명시된 설명을 과잉 해석하여 AI 기능을 삽입하려고 함 
    * 예시: "3년 뒤 5억짜리 집" 같은 자연어를 입력받아 LLM을 이용하여 Target: 5억, Term: 36개월로 구조화된 데이터(JSON)로 변환
* 개선: 과제 안내서를 기준으로 AI 활용의 범위를 재정의하고, AI의 역할을 사고 보조 도구로 제한하였음. 
    * 구체적으로, AI 활용 능력은 AI를 개발 파트너로써 잘 활용하는 것이지, AI 서비스를 제공하는 것이 목표가 아님을 명시하였음
    * 목표는 48시간 이내에 간단한 프로토타입을 구현하는 것이라고 제한을 명확히 하였음

### 6.3 로직 구현 및 교차 검증
#### 6.3.1 초안 TVM(Time Value of Money) 설계 및 기본 로직 검증 (AI 협업)

* 기본 TVM(Time Value of Money) 계산 로직의 초안 작성을 AI에게 요청함
* 마이너스 금리에 대하여 무이자 처리하도록 코드가 제안되어 이를 마이너스 금리의 경우를 따로 처리하도록 수정함
* 역할을 부여하여 "금융 시스템 관점에서 발생 가능한 치명적 엣지 케이스"들에 대하여 식별하도록 지시함
<!-- 여기에 테이블 입력 -->
| 구분 | AI가 지적한 취약점 | 나의 검증 및 해결 방안 (Action) |
| --- | --- | --- |
| **논리적 오류** | `target_amount`가 0일 경우, 달성률 계산 시 `ZeroDivisionError` 발생 가능 | **[Fix]** 목표 금액이 0 이하일 경우 계산을 수행하지 않고 예외 메시지를 반환하도록 가드 절(Guard Clause) 추가 |
| **금융적 오류** | 연이자율이 음수(-)일 경우, 복리 공식을 적용하지 않고 단순 합산 처리하는 로직 발견 (`if monthly_rate > 0`) | **[Fix]** 마이너스 금리 시대에도 복리 계산은 유효함. 이자율이 0일 때만 예외 처리하고, 음수일 때도 복리 공식이 작동하도록 조건문 수정 |
| **데이터 타입** | `float` 자료형 사용 시 부동소수점 오차로 인해 금전적 정합성이 깨질 위험 | **[Decision]**  향후 필요시 `Decimal` 도입하여 일괄 수정해야함을 주석으로 표시  |
| **엣지 케이스** | 기간(Years)에 음수나 실수가 입력될 경우 검증 로직 부재 | **[Fix]** 입력단(Pydantic/Form)에서 양의 정수만 받도록 강제하고, 백엔드 로직에서도 `abs()` 처리 추가 |

#### 6.3.2 금융 로직 정교화: 실질 구매력 및 세후 수익률 반영
* 문제 발견: AI 제안한 TVM 코드는 단순 복리 계산에만 치중되어 있어, 실제 투자 환경인 물가 상승과 세금(이자소득세)을 간과하고 있음을 발견함
    * 3년 뒤 5,000만원과 현재의 5,000만원과 가치가 다르며, 명목 수익률이 5%라도 세금 15.4%를 데고 나면 실제 목표 달성 가능성이 낮아진다는 점을 고려함
* 개선 및 AI 협업 과정
    1. Context 제공: AI에게 일반적인 이자소득세율과 목표 물가상승률을 변수로 추가하여, 사용자가 체감하는 실질 가치를 기준으로 역산하도록 로직 수정을 요청함
    2. Trade-off 발생: 금융 변수가 복잡해지자 **AI가 기존에 작성했던 입력값 검증(Validation) 코드를 누락시키는 현상**을 발견함
    3. 누락된 가드 절(Guard Clause)을 수동으로 복구 및 강화
    4. 기획서에 솔루션 제안 기능에 포함되어야 했던 PMT(월 저축액) 역산 로직이 미포함되어 있는 것을 발견
    5. PMT 역산 로직이 수익률이 음수인 경우에도 계속해서 계산되는 것을 발견. 음수 수익률일 때 계속 저축 또는 투자를 추천하는 것은 비정상적인 insight라 판단하여 이에 대한 연산을 하지 않도록 수정함
    6. 최종 로직 확정:
        1) 세후 수익률: 이익 발생 시에만 DEFAULT_TEX_RATE(0.154) 적용
        2) 실질 가치 환산: 물가상승률을 반영하여 미래 가치를 현재 가치로 역산
        3) 입력 검증 강화: 비정상 수익률(500% 초과 또는 -100% 미만) 및 1개월 미만 기간 차단 로직 수동 추가
        4) PMT(월 저축액) 역산 로직 포함: Target(Real)에 물가상승률을 곱해 Target(Nominal)을 구하고, 여기서 PV가 불어난 금액을 뺌. 남은 부족분을 Annuity Factor로 나누어 필요 월 저축액을 산출함
        
#### 6.3.3 구조적 리팩토링: 모듈화 및 유지 보수성 향상
* 개선 내용: 거대했던 'run_simulation' 메서드를 단일 책임 원칙에 따라 분리
* 기대 효과:
    1) 유지보수성: 금융 법규 변경(세율 등)이나 계산 공식 수정 시 해당 메서드만 수정하여 리스크 최소화
    2) 검증가능성: 각 연산 단계별로 독립적인 입력값 검증 및 결과값 확인이 가능해져 로직의 신뢰도 확보
    3) 확장성: 향후 다중 목표 설정 기능 추가 시, 분리된 연산 모듈을 재사용할 수 있는 기반 마련

#### 6.3.4 데이터 시각화 정합성 강화: 백엔드 시계열 생성 로직 도입
* 문제 정의: UI 단에서 임의로 시계열 데이터를 보간(Interpolation)할 경우, 백엔드의 복리 계산 엔진 결과와 차트 상의 수치가 일치하지 않는 '데이터 불일치' 리스크 식별
* 해결 방안: `generate_timeseries` 메서드를 엔진에 추가하여, 실제 월별 복리 및 세금 로직이 반영된 명목/실질 자산 추이 데이터를 백엔드에서 직접 생성하여 전달함
* 기대 효과: 
    * UI는 데이터 렌더링에만 집중하여 관심사 분리 실현.
    * 사용자가 시뮬레이션 과정에서 자산 성장의 곡선을 더 정확하게 인지할 수 있도록 금융적 신뢰도 향상

